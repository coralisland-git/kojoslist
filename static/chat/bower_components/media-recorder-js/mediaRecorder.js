!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.QBMediaRecorder=e()}}(function(){return function e(t,o,r){function i(a,s){if(!o[a]){if(!t[a]){var d="function"==typeof require&&require;if(!s&&d)return d(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){var o=t[a][1][e];return i(o?o:e)},u,u.exports,e,t,o,r)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,o){"use strict";t.exports={unsupport:"QBMediaRecorder is not supported this environment.",unsupportMediaRecorderWithOptions:"Got a warning when creating a MediaRecorder, trying to create MediaRecorder without options.",requreArgument:"1 argument required, but only 0 present.",callbackError:"Founded an error in callback:",actionFailed:"QBMediaRecorder is not created or has an invalid state.",no_recorded_chunks:"Does not have any recording data.",streamRequired:"MediaStream is required.",InvalidState:"QBMediaRecorder is not in a state in which the proposed operation is allowed to be executed.",OutOfMemory:"The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",IllegalStreamModification:"A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",OtherRecordingError:"Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",GenericError:"The UA cannot provide the codec or recording option that has been requested"}},{}],2:[function(e,t,o){"use strict";function r(e){var t=!(!e||!e.mimeType)&&e.mimeType;if(this._customMimeType="audio/wav"===t?"audio/wav":"audio/mp3"===t&&"audio/mp3",!r.isAvailable()&&!this._customMimeType)throw new Error(i.unsupport);this.mimeType=this._getMimeType(t),this.timeslice=e&&e.timeslice&&isNaN(+e.timeslice)?e.timeslice:1e3,this.callbacks=e?this._getCallbacks(e):{},this.recordedBlobs=[],this.ignoreMutedMedia=!e||"boolean"!=typeof e.ignoreMutedMedia||e.ignoreMutedMedia,this._stream=null,this._mediaRecorder=null,this._recordedChunks=[],this._keepRecording=!1,this._customMimeType&&this._setCustomRecorderTools()}var i=e("./errors");r.prototype._setCustomRecorderTools=function(){if(!r._isAudioContext())throw new Error(i.unsupport);var e=this;e.mimeType=e._customMimeType,e.BUFFER_SIZE=2048,e.INPUT_CHANNELS=1,e.OUTPUT_CHANNELS=1,e._audioContext=null,e._buffer=[],e._recordingLength=0,r._isMp3Encoder()&&"audio/mp3"===this._customMimeType&&(e._mp3encoder=new lamejs.Mp3Encoder(1,48e3,256))},r.prototype._getMimeType=function(e){var t,o="video";return e&&r.isTypeSupported(e)?t=e:e?(o=e.toString().toLowerCase().indexOf("audio")===-1?"video":"audio",t=r.getSupportedMimeTypes(o)[0]):t=r.getSupportedMimeTypes(o)[0],t},r.prototype._getCallbacks=function(e){var t={},o=["onstart","onstop","onpause","onresume","onerror","onchange","ondataavailable"];return o.forEach(function(o){o in e&&(t[o]=e[o])}),t},r._mimeTypes=e("./mimeTypes"),r._STATES=["inactive","recording","paused"],r.isAvailable=function(){return!!(window&&window.MediaRecorder&&"function"==typeof window.MediaRecorder.isTypeSupported&&window.Blob)},r._isAudioContext=function(){return!(!window||!window.AudioContext&&!window.webkitAudioContext)},r._isMp3Encoder=function(){return!(!window||!window.AudioContext&&!window.webkitAudioContext||!window.lamejs)},r.isTypeSupported=function(e){var t=!1;if(!r.isAvailable())throw new Error(i.unsupport);if(!e)throw new Error(i.requreArgument);switch(e){case"audio/wav":r._isAudioContext()&&(t=!0);break;case"audio/mp3":r._isAudioContext()&&r._isMp3Encoder()&&(t=!0);break;default:t=window.MediaRecorder.isTypeSupported(e)}return t},r.getSupportedMimeTypes=function(e){var t=e||"video";if(!r.isAvailable())throw new Error(i.unsupport);return r._mimeTypes[t].filter(function(e){return r.isTypeSupported(e)})},r.prototype.getState=function(){return this._mediaRecorder?this._mediaRecorder.state:r._STATES[0]},r.prototype.start=function(e){var t=this;if(!e)throw new Error(i.requreArgument);var o=this.getState();o!==r._STATES[1]&&o!==r._STATES[2]||this._mediaRecorder.stop(),this._stream&&(this._stream=null),t._stream=e,t._mediaRecorder=null,t._recordedChunks.length=0,t._customMimeType?t._setCustomRecorder():t._setMediaRecorder(),t._setEvents()},r.prototype._setMediaRecorder=function(){var e=this;try{e._mediaRecorder=new window.MediaRecorder(e._stream,{mimeType:e.mimeType,ignoreMutedMedia:e.ignoreMutedMedia})}catch(t){console.warn(i.unsupportMediaRecorderWithOptions,t),e._mediaRecorder=new window.MediaRecorder(e._stream)}},r.prototype._setCustomRecorder=function(){var e=this;e._closeAudioProcess(),e._mediaRecorder={start:function(){try{this.state=r._STATES[1],e._startAudioProcess(),this.onstart()}catch(e){this.onerror(e)}},stop:function(){try{this.state=r._STATES[0],e._stopAudioProcess(),this.onstop()}catch(e){this.onerror(e)}},pause:function(){try{this.state=r._STATES[2],this.onpause()}catch(e){this.onerror(e)}},resume:function(){try{this.state=r._STATES[1],this.onresume()}catch(e){this.onerror(e)}},onstart:function(){"recording"!==this.state&&(this.state=r._STATES[1])},onstop:function(){"inactive"!==this.state&&(this.state=r._STATES[0])},onpause:function(){"paused"!==this.state&&(this.state=r._STATES[2])},onresume:function(){"recording"!==this.state&&(this.state=r._STATES[1])},onerror:function(){try{e._closeAudioProcess()}catch(e){throw new Error(e)}}}},r.prototype._fireCallback=function(e,t){var o=this;if(0!==Object.keys(o.callbacks).length&&"function"==typeof o.callbacks[e])try{o.callbacks[e](t)}catch(t){console.error("Founded an error in callback:"+e,t)}},r.prototype._setEvents=function(){var e=this;e._customMimeType||(e._mediaRecorder.ondataavailable=function(t){t.data&&t.data.size>0&&(e._recordedChunks.push(t.data),e._fireCallback("ondataavailable",t))}),e._mediaRecorder.onpause=function(){e._fireCallback("onpause")},e._mediaRecorder.onresume=function(){e._fireCallback("onresume")},e._mediaRecorder.onerror=function(t){switch(t.name){case"InvalidState":console.error(i[t.name]);break;case"OutOfMemory":console.error(i[t.name]);break;case"IllegalStreamModification":console.error(i[t.name]);break;case"OtherRecordingError":console.error(i[t.name]);break;case"GenericError":console.error(i[t.name]);break;default:console.error("MediaRecorder Error",t)}"inactive"!==e._mediaRecorder.state&&e._mediaRecorder.stop(),e._userCallbacks&&"function"==typeof e._userCallbacks.onErrorRecording&&e._fireCallback("onerror",t)},e._mediaRecorder.onstop=function(){var t=new Blob(e._recordedChunks,{type:e.mimeType});e.recordedBlobs.push(t),e._keepRecording||(e.recordedBlobs.length>1?e._fireCallback("onstop",t):e._fireCallback("onstop",e.recordedBlobs[0])),e._keepRecording=!1},e._mediaRecorder.start(e.timeslice),e._fireCallback("onstart")},r.prototype.stop=function(){var e=this._mediaRecorder,t=e&&e.state?e.state:"inactive";!e||"recording"!==t&&"paused"!==t?console.warn(i.actionFailed):e.stop()},r.prototype.pause=function(){var e=this;e._mediaRecorder&&"recording"===e._mediaRecorder.state?e._mediaRecorder.pause():console.warn(i.actionFailed)},r.prototype.resume=function(){var e=this;e._mediaRecorder&&"paused"===e._mediaRecorder.state?e._mediaRecorder.resume():console.warn(i.actionFailed)},r.prototype.change=function(e){var t=this;if(!e)throw new Error(i.requreArgument);t._keepRecording=!0,t.stop(),t._stream=null,t._mediaRecorder=null,t._stream=e,t._customMimeType?t._setCustomRecorder():t._setMediaRecorder(),t._setEvents()},r.prototype.download=function(e,t){var o=this,i=this.getState();i!==r._STATES[1]&&i!==r._STATES[2]||this._mediaRecorder.stop();var n=URL.createObjectURL(t||o._getBlobRecorded()),a=document.createElement("a");a.style.display="none",a.href=n,a.download=(e||Date.now())+"."+o._getExtension(),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(n)},100)},r.prototype._getBlobRecorded=function(e){var t=this,o=e||t._recordedChunks;return o.length?new Blob(o,{type:t.mimeType}):(console.warn(i.no_recorded_chunks),!1)},r.prototype._getExtension=function(){var e=this,t=e.mimeType.indexOf("/"),o=e.mimeType.substring(t+1),r=o.indexOf(";");return r!==-1&&(o=o.substring(0,r)),o},r.prototype._startAudioProcess=function(){if(!r._isAudioContext())throw new Error(i.unsupport);var e,t,o,n,a=this;a._closeAudioProcess(),e=window.AudioContext||window.webkitAudioContext,a._audioContext=new e,n=a._audioContext.createGain(),t=a._audioContext.createMediaStreamSource(a._stream),o=a._audioContext.createScriptProcessor(a.BUFFER_SIZE,a.INPUT_CHANNELS,a.OUTPUT_CHANNELS),t.connect(n),o.onaudioprocess=function(e){a._mediaRecorder.state===r._STATES[1]&&(a._buffer.push(new Float32Array(e.inputBuffer.getChannelData(0))),a._recordingLength+=a.BUFFER_SIZE)},n.connect(o),o.connect(a._audioContext.destination)},r.prototype._closeAudioProcess=function(){var e=this;e._audioContext&&e._audioContext.close().then(function(){e._audioContext=null,e._recordingLength=0,e._buffer=[]})},r.prototype._stopAudioProcess=function(){var e=this;e._recordedChunks=e._getBlobData(),e._closeAudioProcess()},r.prototype._encodeMP3=function(e){var t=this,o=new Int16Array(e),r=t._mp3encoder.encodeBuffer(o),i=t._mp3encoder.flush(),n=[];return n.push(r),n.push(new Int8Array(i)),n},r.prototype._encodeWAV=function(e){function t(e,t,o){for(var r=0;r<o.length;r++,t+=2){var i=Math.max(-1,Math.min(1,o[r]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}function o(e,t,o){for(var r=0;r<o.length;r++)e.setUint8(t+r,o.charCodeAt(r))}var r=new ArrayBuffer(44+2*e.length),i=new DataView(r);return o(i,0,"RIFF"),i.setUint32(4,32+2*e.length,!0),o(i,8,"WAVE"),o(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,this.sampleRate,!0),i.setUint32(28,2*this.sampleRate,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),o(i,36,"data"),i.setUint32(40,2*e.length,!0),t(i,44,e),i},r.prototype._getBlobData=function(){for(var e,t,o,r=this,n=new Float32Array(r._recordingLength),a=r._buffer.length,s=0,d=0;d<a;d++)e=r._buffer[d],n.set(e,s),s+=e.length;switch(t=r._encodeWAV(n),r._customMimeType){case"audio/wav":o=[t];break;case"audio/mp3":o=r._encodeMP3(t.buffer);break;default:throw new Error(i.unsupportMediaRecorderWithOptions)}return o},t.exports=r},{"./errors":1,"./mimeTypes":3}],3:[function(e,t,o){"use strict";t.exports={audio:["audio/webm;codecs=opus","audio/webm","audio/ogg","audio/wav","audio/mp3"],video:["video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm;codecs=daala","video/webm","video/mp4","video/mpeg"]}},{}]},{},[2])(2)});