{% extends "_base.html" %} 
{% load staticfiles %} 

{% block page_content %}
<div id="page" class="site">
    <div class="site-inner">

        <!-- Header -->
        <header>
            <!-- Header Menu -->
            <div class="header-menu">
                <nav class="navbar">
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#myNavbar">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <div class="navbar-brand">
                                <a href="/" class="custom-logo-link" rel="home" itemprop="url"><img width="240" height="67" src="/static/img/cropped-logo.png" class="custom-logo" alt="" itemprop="logo" style="transform: scale(1.1);" /></a>
                            </div>
                        </div>
                        <div class="collapse navbar-collapse" id="myNavbar">

                            <div id="site-header-menu" class="site-header-menu">
                                <nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
                                    <div class="menu-main-menu-container">
                                        <ul id="menu-main-menu" class="nav navbar-nav navbar-right">
                                            <li id="menu-item-42" class="home menu-item menu-item-type-custom menu-item-object-custom menu-item-42"><a href="/profile/" class="">Home</a></li>
                                            {% if user.is_authenticated %}
                                                <li><a href="/logout">Log Out</a></li>
                                                <li><a href="/post-ads/">Post Ads</a></li>
                                            {% else %}
                                                <li><a href="/accounts/signup" data-toggle="modal">Sign Up</a></li>
                                                <li><a href="/accounts/login" data-toggle="modal">Login</a></li>
                                            {% endif %}
                                            <li id="menu-item-13" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-13"><a href="/about/">About</a></li>
                                            <li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="/contact-us/">Contact Us</a></li>
                                        </ul>
                                    </div>
                                </nav>
                                <!-- .main-navigation -->
                            </div>
                            <!-- .site-header-menu -->

                        </div>
                    </div>
                </nav>
            </div>
            <!-- End Header Menu -->
        </header>
        <!-- End Header -->

        {% block meta_main %}
        <div id="content" class="site-content">
            <!-- Content -->

            <div id="content">

                <div class="container-fluid">

                    <div class="row">

                        <div class="top-space" style="background-color: #2C2D2F; height: 50px;">

                        </div>
                        <div class="full-map-section">

                            <div id="main_map"></div>
                            <div class="container hedle_zoom">


                            </div>

                        </div>

                        <div class="home-page-country">

                            <div class="row">

                                <div class="" style="text-align: center; padding: 0px 45px;">

                                    <h3 style="margin-bottom: 20px; font-weight: 300; color: white;text-transform: uppercase;">view <span style="color: #4dbee2;">ads</span> from all over the world</h3>
                                    <a href="/region-ads/wd/" id="main_page_button" class="btn btn-default col-md-4 col-md-offset-4  col-xs-12 btn-view-all" style="margin-bottom: 20px;">View Ads from All Countries</a>

                                    <div class="content-select-country clearfix" style="text-align: center;">
                                </div>

                            </div>

                            <div class="container" style="margin-top: 20px; text-align: center">

                                <div class="row">

                                    <div class="col-md-12">

                                            <!-- {% autoescape off %}{{ rndr_str }}{% endautoescape %} -->
                                        </div>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

            <!-- End Content -->
        </div>
        {% endblock %}

        {% block page_body %}
        {% endblock %}

        <!-- .site-content -->
        <footer id="colophon" class="site-footer" role="contentinfo">

            <div class="container">
                <div class="row">
                    <!-- Footer Top -->
                    <div class="footer-top clearfix">
                        <div class="col-sm-3 col-xs-6">
                            <section id="text-2" class="widget widget_text">
                                <h4 class="widget-title">About Us</h4>
                                <div class="textwidget">
                                    <ul>
                                        <li><a href="/why-global-board/">Why Global Board?</a></li>
                                        <li><a href="/about/">GlobalBoard Is</a></li>
                                        <li><a href="/contact-us/">Contact Us</a></li>
                                    </ul>
                                </div>
                            </section>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <section id="text-3" class="widget widget_text">
                                <h4 class="widget-title">Services</h4>
                                <div class="textwidget">
                                    <ul>
                                        <li><a href="/how-it-works/">How it works?</a></li>
                                        <li><a href="/why-use/">Why use?</a></li>
                                        <li><a href="/terms-of-use/">Terms & Privacy</a></li>
                                    </ul>
                                </div>
                            </section>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <section id="text-4" class="widget widget_text">
                                <h4 class="widget-title">Global Board</h4>
                                <div class="textwidget">
                                    <ul>
                                        <li><a href="/customer-support/">Customer Support</a></li>
                                        <li><a href="/faq/">FAQ</a></li>
                                        <!--<li><a href="#">Press Center</a></li>-->
                                    </ul>
                                </div>
                            </section>
                        </div>
                        <div class="col-sm-3 col-xs-6">
                            <section id="text-5" class="widget widget_text">
                                <h4 class="widget-title">Follow Us</h4>
                                <div class="textwidget">
                                    <ul class="social-icons">
                                        <li>
                                            <a href="https://www.facebook.com/globalboard.world"><i class="fa fa-facebook" aria-hidden="true"></i>
</a>
                                            <a href="https://www.linkedin.com/public-profile/settings?trk=d_flagship3_profile_self_view_public_profile"><i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
                                        </li>
                                        <li>
                                            <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i>
</a>
                                            <a href="https://www.instagram.com/globalboard.world/"><i class="fa fa-instagram" aria-hidden="true"></i>
</a>
                                        </li>
                                    </ul>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
                <div class="site-info">
                    &copy Copyright 2018 GlobalBoard </div>
                <!-- .site-info -->
        </footer>
        <!-- .site-footer -->
        </div>
        <!-- .site-inner -->
    </div>
    <!-- .site -->
    
{% endblock %}

{% block extra_js %} 
<!-- <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=AIzaSyDQrnUcIKY_gsk7ybJ1bH8GcBRPBtKhVXA&ver=3.exp"></script>
 -->
<script type="text/javascript" src="//maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=AIzaSyBS50juRrOSRY2oW99-cP_xbUPQp00mg3k&ver=3.exp"></script>

<script type="text/javascript">
    var mode = '{{ request.GET.q }}';
    console.log(mode);
    // debugger;
    // if (mode != '')
    //     parent.location.href = '/?q='+mode;
    //     jQuery.get("https://api.ipdata.co?api-key=test", function(response) {
    //         var geo_lat = response.latitude;
    //         var geo_lng = response.longitude;
    //         jQuery.ajax({
    //             type: 'get',
    //             url: '/place_country_list',
    //             data: { 
    //                 countryCode: response.country_code,
    //                 stateCode : response.region_code,
    //                 state: response.region,
    //                 city: response.city
    //             },
    //             success: function (data) {
    //                 jQuery('.content-select-country').html(data)
    //                 jQuery('#country_list').change(function(e) {
    //                     location.href = $('#country_list').val();
    //                 });
    //             }
    //         }); 
    //     });

    navigator.geolocation.getCurrentPosition(
        function( position ){
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            var google_maps_geocoder = new google.maps.Geocoder();
            // jQuery.get("https://api.ipdata.co?api-key=test", function(response) {
            // jQuery.get("https://ipinfo.io/", function(response) {
                // var geo_lat = response.loc.split(',')[0];
                // var geo_lng = response.loc.split(',')[1];
                // var geo_lat = response.latitude;
                // var geo_lng = response.longitude;
                // var google_map_pos = new google.maps.LatLng( geo_lat, geo_lng );
            var google_map_pos = new google.maps.LatLng( lat,lng );
            var geo_loc = '';
            new Promise(function(resolve){
                google_maps_geocoder.geocode(
                    { 'latLng': google_map_pos },
                    function( results, status ) {
                        if ( status == google.maps.GeocoderStatus.OK && results[0] ) {
                            // debugger;
                            // console.log('########## google api : ',  results[0].formatted_address );
                            resolve(results)
                        }
                    }
                );
                
            })
            .then(function(results) {
                console.log('~~~~~~~~~~~~~', results[0].address_components);
                var arrAddress = results[0].address_components;
                var itemRoute='';
                var itemLocality='';
                var itemCountry='';
                var itemCountryCode='';
                var itemProvince='';
                var itemProvinceCode='';
                var itemPc='';
                var itemSnumber='';
                // iterate through address_component array
                $.each(arrAddress, function (i, address_component) {
                    console.log('address_component:'+i);

                    if (address_component.types[0] == "route"){
                        console.log(i+": route:"+address_component.long_name);
                        itemRoute = address_component.long_name;
                    }

                    if (address_component.types[0] == "administrative_area_level_1"){ 
                        console.log("pc:"+address_component.long_name);  
                        itemProvince = address_component.long_name;
                        itemProvinceCode = address_component.short_name;
                    }

                    if (address_component.types[0] == "locality"){
                        console.log("town:"+address_component.long_name);
                        itemLocality = address_component.long_name;
                    }

                    if (address_component.types[0] == "country"){ 
                        console.log("country:"+address_component.long_name); 
                        itemCountry = address_component.long_name;
                        itemCountryCode = address_component.short_name;
                    }

                    if (address_component.types[0] == "postal_code_prefix"){ 
                        console.log("pc:"+address_component.long_name);  
                        itemPc = address_component.long_name;
                    }

                    if (address_component.types[0] == "street_number"){ 
                        console.log("street_number:"+address_component.long_name);  
                        itemSnumber = address_component.long_name;
                    }
                });
                jQuery.ajax({
                    type: 'get',
                    url: '/place_country_list',
                    data: { 
                        countryCode: itemCountryCode,
                        stateCode : itemProvinceCode,
                        state: itemProvince,
                        city: itemLocality
                    },
                    success: function (data) {
                        jQuery('.content-select-country').html(data)
                        jQuery('#country_list').change(function(e) {
                            location.href = $('#country_list').val();
                        });
                    }
                }); 
            })
            // }, "jsonp");
        },
        function(){
            jQuery.ajax({
                    type: 'get',
                    url: '/place_country_list',
                    data: { 
                    },
                    success: function (data) {
                        jQuery('.content-select-country').html(data)
                        jQuery('#country_list').change(function(e) {
                            location.href = $('#country_list').val();
                        });
                    }
                }); 
        }
    );
</script>
{% endblock %}
